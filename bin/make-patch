#!/bin/bash
# $1: Proto file name
# make-patch CgProto
function makepatch() {
  local Proto="$1"
  if [[ $(diff -q ${Proto}.ts ${Proto}-patched.ts) ]] ; then
    cp ${Proto}.ts ${Proto}-patched.ts
    #npm run protots; 
    protoc -I . --ts_out=. ${Proto}.proto
    diff -patch ${Proto}.ts ${Proto}-patched.ts > ${Proto}.patch
    #npm run patch-proto
    patch ${Proto}.ts < ${Proto}.patch
  else
    echo 'no diff' ${Proto}
  fi
}
for p in "$@" ; do (cd src/proto; makepatch "$p"); done